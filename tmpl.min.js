!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.tmpl=e():t.tmpl=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n=r(1),i=r(15);t.exports={template:function(t,e){var r=n.parse(t);return{handle:function(t,i){n.traverse(r,e).when(t,i)}}},html:function(t,e){return i.getHTMLString(t,e)}}},function(t,e,r){var n=r(2),i=r(3),a=r(4),o=r(7),s=r(6);t.exports={_modules:{"ws-include":r(10),"ws-template":r(12),"ws-applytemplate":r(13),"ws-partial":r(14)},_regex:{forVariables:/\{\{ ?(.*?) ?\}\}/g},safeReplaceCaseReg:/\r|\n|\t|\/\*[\s\S]*?\*\//g,safeReplaceCasePlace:"",includeStack:{},templateStack:{},parse:function(t,e){var r=new n.DefaultHandler(e||this.defaultHandler,{ignoreWhitespace:!0}),i=new n.Parser(r);return i.parseComplete(t),r.dom},_traverseTagAttributes:function(t){var e=i.clone(t);return i.eachObject(e,function(t){return this._traverseText({data:t})}.bind(this))},_replaceAllUncertainStuff:function(t){return t.trim().replace(this.safeReplaceCaseReg,this.safeReplaceCasePlace)},_searchForVars:function(t){return i.mapForLoop(t,function(t){return t.split(this._regex.forVariables).join("")}.bind(this))},_replaceAndCreateStatements:function(t,e){return i.mapForLoop(t,function(t){return a.checkStatementForInners(t,e)}.bind(this))},_createDataObject:function(t,e){return e?t.data=this._replaceAndCreateStatements(t.data,e):t.data=s.createDataText(t.data[0]),t},_replaceMatch:function(t){var e,r=this._replaceAllUncertainStuff(t.data),n=r.match(this._regex.forVariables);return n&&(e=this._searchForVars(n)),t.data=r.split(this._regex.forVariables),this._createDataObject(t,e)},_lookForStatements:function(t){return this._replaceMatch(t)},_whatMethodShouldYouUse:function(t){return s.isTag(t.type)?this._modules[t.name]?this._traverseModule:this._traverseTag:s.isText(t.type)?this._traverseText:void 0},actionOnMainArray:function(t,e){if(void 0!==e)if(e.length>0)for(var r=0;r<e.length;r++)t.concat(this.actionOnMainArray(t,e[r]));else t.push(e);return e=null,t},_collect:function(t,e,r,n){var i=t.call(this,e,r,n);return i},traversingAST:function(t){for(var e,r,n=[],i=0;i<t.length;i++)e=this._whatMethodShouldYouUse(t[i]),e&&(r=this._collect(e,t[i],t[i-1],t[i+1]),void 0!==r&&n.push(r));return o.every(n)},traverse:function(t,e){return e&&(this.resolver=e),this.traversingAST(t).when(function(t){return this.actionOnMainArray([],t)}.bind(this),function(t){throw new Error(t)})},_generatorFunctionForTags:function(t,e){return t.children=this.actionOnMainArray([],e),t},traverseTagWithChildren:function(t){return this.traversingAST(t.children).when(function(e){return this._generatorFunctionForTags(t,e)}.bind(this),function(t){throw new Error(t)})},_traverseTag:function(t,e,r){var n,i=this._traverseTagAttributes(t.attribs),a=this._createTag(t.name,t.data,t.raw,i,t.children,e,r);return a.children&&a.children.length>0?this.traverseTagWithChildren(a):(n=o.make(),n.keep(this._generatorFunctionForTags(a)),n.promise)},_traverseModule:function(t){var e=s.parserMatcher.call(this,t);return s.loadModuleFunction.call(this,e,t)},_traverseText:function(t){var t=i.clone(t),e=o.make();return t.hasOwnProperty("type")?(t.raw=this._replaceAllUncertainStuff(t.raw),e.keep(this._lookForStatements(t)),e.promise):this._lookForStatements(t)},_createTag:function(t,e,r,n,i,a,o){return{name:t,data:e,raw:r,attribs:n,children:i,type:"tag",prev:a,next:o}},defaultHandler:function(t,e){if(t)throw new Error(t)}}},function(t,e,r){(function(r,n){!function(){function i(){return"object"==typeof e&&"object"==typeof t&&"string"==typeof r&&"string"==typeof n}function a(t,e){this._options=e?e:{},void 0==this._options.includeLocation&&(this._options.includeLocation=!1),this.validateHandler(t),this._handler=t,this.reset()}function o(t){o.super_.call(this,t,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}function s(t,e){this.reset(),this._options=e?e:{},void 0==this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),void 0==this._options.verbose&&(this._options.verbose=!0),void 0==this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),"function"==typeof t&&(this._callback=t)}function c(t,e){var r=function(){};r.prototype=e.prototype,t.super_=e,t.prototype=new r,t.prototype.constructor=t}if(!i()){if(this.Tautologistics){if(this.Tautologistics.NodeHtmlParser)return}else this.Tautologistics={};this.Tautologistics.NodeHtmlParser={},e=this.Tautologistics.NodeHtmlParser}var u={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};a._reTrim=/(^\s+|\s+$)/g,a._reTrimComment=/(^\!--|--$)/g,a._reWhitespace=/\s/g,a._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,a._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,a._reTags=/[\<\>]/g,a.prototype.parseComplete=function(t){this.reset(),this.parseChunk(t),this.done()},a.prototype.parseChunk=function(t){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=t,this.parseTags()},a.prototype.done=function(){if(!this._done){if(this._done=!0,this._buffer.length){var t=this._buffer;this._buffer="";var e={raw:t,data:this._parseState==u.Text?t:t.replace(a._reTrim,""),type:this._parseState};(this._parseState==u.Tag||this._parseState==u.Script||this._parseState==u.Style)&&(e.name=this.parseTagName(e.data)),this.parseAttribs(e),this._elements.push(e)}this.writeHandler(),this._handler.done()}},a.prototype.reset=function(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=u.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},a.prototype._options=null,a.prototype._handler=null,a.prototype._buffer=null,a.prototype._done=!1,a.prototype._elements=null,a.prototype._elementsCurrent=0,a.prototype._current=0,a.prototype._next=0,a.prototype._location=null,a.prototype._parseState=u.Text,a.prototype._prevTagSep="",a.prototype._tagStack=null,a.prototype.parseTagAttribs=function(t){for(var e=t.length,r=0;e>r;){var n=t[r++];(n.type==u.Tag||n.type==u.Script||n.type==u.style)&&this.parseAttribs(n)}return t},a.prototype.parseAttribs=function(t){if(t.type==u.Script||t.type==u.Style||t.type==u.Tag){var e=t.data.split(a._reWhitespace,1)[0],r=t.data.substring(e.length);if(!(r.length<1)){var n;for(a._reAttrib.lastIndex=0;n=a._reAttrib.exec(r);)void 0==t.attribs&&(t.attribs={}),"string"==typeof n[1]&&n[1].length?t.attribs[n[1]]=n[2]:"string"==typeof n[3]&&n[3].length?t.attribs[n[3].toString()]=n[4].toString():"string"==typeof n[5]&&n[5].length?t.attribs[n[5]]=n[6]:"string"==typeof n[7]&&n[7].length&&(t.attribs[n[7]]=n[7])}}},a.prototype.parseTagName=function(t){if(null==t||""==t)return"";var e=a._reTagName.exec(t);return e?(e[1]?"/":"")+e[2]:""},a.prototype.parseTags=function(){for(var t=this._buffer.length-1;a._reTags.test(this._buffer);){this._next=a._reTags.lastIndex-1;var e=this._buffer.charAt(this._next),r=this._buffer.substring(this._current,this._next),n={raw:r,data:this._parseState==u.Text?r:r.replace(a._reTrim,""),type:this._parseState},i=this.parseTagName(n.data);if(this._tagStack.length)if(this._tagStack[this._tagStack.length-1]==u.Script){if("/script"==i.toLowerCase())this._tagStack.pop();else if(0!=n.raw.indexOf("!--")&&(n.type=u.Text,this._elements.length&&this._elements[this._elements.length-1].type==u.Text)){var o=this._elements[this._elements.length-1];o.raw=o.data=o.raw+this._prevTagSep+n.raw,n.raw=n.data=""}}else if(this._tagStack[this._tagStack.length-1]==u.Style){if("/style"==i.toLowerCase())this._tagStack.pop();else if(0!=n.raw.indexOf("!--"))if(n.type=u.Text,this._elements.length&&this._elements[this._elements.length-1].type==u.Text){var o=this._elements[this._elements.length-1];""!=n.raw?(o.raw=o.data=o.raw+this._prevTagSep+n.raw,n.raw=n.data=""):o.raw=o.data=o.raw+this._prevTagSep}else""!=n.raw&&(n.raw=n.data=n.raw)}else if(this._tagStack[this._tagStack.length-1]==u.Comment){var s=n.raw.length;if("-"==n.raw.charAt(s-2)&&"-"==n.raw.charAt(s-1)&&">"==e)if(this._tagStack.pop(),this._elements.length&&this._elements[this._elements.length-1].type==u.Comment){var o=this._elements[this._elements.length-1];o.raw=o.data=(o.raw+n.raw).replace(a._reTrimComment,""),n.raw=n.data="",n.type=u.Text}else n.type=u.Comment;else if(n.type=u.Comment,this._elements.length&&this._elements[this._elements.length-1].type==u.Comment){var o=this._elements[this._elements.length-1];o.raw=o.data=o.raw+n.raw+e,n.raw=n.data="",n.type=u.Text}else n.raw=n.data=n.raw+e}if(n.type==u.Tag){n.name=i;var c=i.toLowerCase();if(0==n.raw.indexOf("!--")){n.type=u.Comment,delete n.name;var s=n.raw.length;"-"==n.raw.charAt(s-1)&&"-"==n.raw.charAt(s-2)&&">"==e?n.raw=n.data=n.raw.replace(a._reTrimComment,""):(n.raw+=e,this._tagStack.push(u.Comment))}else 0==n.raw.indexOf("!")||0==n.raw.indexOf("?")?n.type=u.Directive:"script"==c?(n.type=u.Script,"/"!=n.data.charAt(n.data.length-1)&&this._tagStack.push(u.Script)):"/script"==c?n.type=u.Script:"style"==c?(n.type=u.Style,"/"!=n.data.charAt(n.data.length-1)&&this._tagStack.push(u.Style)):"/style"==c&&(n.type=u.Style);n.name&&"/"==n.name.charAt(0)&&(n.data=n.name)}(""!=n.raw||n.type!=u.Text)&&(this._options.includeLocation&&!n.location&&(n.location=this.getLocation(n.type==u.Tag)),this.parseAttribs(n),this._elements.push(n),n.type!=u.Text&&n.type!=u.Comment&&n.type!=u.Directive&&"/"==n.data.charAt(n.data.length-1)&&this._elements.push({raw:"/"+n.name,data:"/"+n.name,name:"/"+n.name,type:n.type})),this._parseState="<"==e?u.Tag:u.Text,this._current=this._next+1,this._prevTagSep=e}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=t?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},a.prototype.getLocation=function(t){for(var e,r=this._location,n=this._current-(t?1:0),i=t&&0==r.charOffset&&0==this._current;r.charOffset<n;r.charOffset++)e=this._buffer.charAt(r.charOffset),"\n"==e?(r.inBuffer++,r.col=0):"\r"!=e&&r.col++;return{line:r.row+r.inBuffer+1,col:r.col+(i?0:1)}},a.prototype.validateHandler=function(t){if("object"!=typeof t)throw new Error("Handler is not an object");if("function"!=typeof t.reset)throw new Error("Handler method 'reset' is invalid");if("function"!=typeof t.done)throw new Error("Handler method 'done' is invalid");if("function"!=typeof t.writeTag)throw new Error("Handler method 'writeTag' is invalid");if("function"!=typeof t.writeText)throw new Error("Handler method 'writeText' is invalid");if("function"!=typeof t.writeComment)throw new Error("Handler method 'writeComment' is invalid");if("function"!=typeof t.writeDirective)throw new Error("Handler method 'writeDirective' is invalid")},a.prototype.writeHandler=function(t){if(t=!!t,!this._tagStack.length||t)for(;this._elements.length;){var e=this._elements.shift();switch(e.type){case u.Comment:this._handler.writeComment(e);break;case u.Directive:this._handler.writeDirective(e);break;case u.Text:this._handler.writeText(e);break;default:this._handler.writeTag(e)}}},a.prototype.handleError=function(t){if("function"!=typeof this._handler.error)throw t;this._handler.error(t)},c(o,s),o.prototype.done=function(){var t,e={},r=l.getElementsByTagName(function(t){return"rss"==t||"feed"==t},this.dom,!1);if(r.length&&(t=r[0]),t){if("rss"==t.name){e.type="rss",t=t.children[0],e.id="";try{e.title=l.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(n){}try{e.link=l.getElementsByTagName("link",t.children,!1)[0].children[0].data}catch(n){}try{e.description=l.getElementsByTagName("description",t.children,!1)[0].children[0].data}catch(n){}try{e.updated=new Date(l.getElementsByTagName("lastBuildDate",t.children,!1)[0].children[0].data)}catch(n){}try{e.author=l.getElementsByTagName("managingEditor",t.children,!1)[0].children[0].data}catch(n){}e.items=[],l.getElementsByTagName("item",t.children).forEach(function(t,r,n){var i={};try{i.id=l.getElementsByTagName("guid",t.children,!1)[0].children[0].data}catch(a){}try{i.title=l.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(a){}try{i.link=l.getElementsByTagName("link",t.children,!1)[0].children[0].data}catch(a){}try{i.description=l.getElementsByTagName("description",t.children,!1)[0].children[0].data}catch(a){}try{i.pubDate=new Date(l.getElementsByTagName("pubDate",t.children,!1)[0].children[0].data)}catch(a){}e.items.push(i)})}else{e.type="atom";try{e.id=l.getElementsByTagName("id",t.children,!1)[0].children[0].data}catch(n){}try{e.title=l.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(n){}try{e.link=l.getElementsByTagName("link",t.children,!1)[0].attribs.href}catch(n){}try{e.description=l.getElementsByTagName("subtitle",t.children,!1)[0].children[0].data}catch(n){}try{e.updated=new Date(l.getElementsByTagName("updated",t.children,!1)[0].children[0].data)}catch(n){}try{e.author=l.getElementsByTagName("email",t.children,!0)[0].children[0].data}catch(n){}e.items=[],l.getElementsByTagName("entry",t.children).forEach(function(t,r,n){var i={};try{i.id=l.getElementsByTagName("id",t.children,!1)[0].children[0].data}catch(a){}try{i.title=l.getElementsByTagName("title",t.children,!1)[0].children[0].data}catch(a){}try{i.link=l.getElementsByTagName("link",t.children,!1)[0].attribs.href}catch(a){}try{i.description=l.getElementsByTagName("summary",t.children,!1)[0].children[0].data}catch(a){}try{i.pubDate=new Date(l.getElementsByTagName("updated",t.children,!1)[0].children[0].data)}catch(a){}e.items.push(i)})}this.dom=e}o.super_.prototype.done.call(this)},s._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},s.reWhitespace=/^\s*$/,s.prototype.dom=null,s.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},s.prototype.done=function(){this._done=!0,this.handleCallback(null)},s.prototype.writeTag=function(t){this.handleElement(t)},s.prototype.writeText=function(t){this._options.ignoreWhitespace&&s.reWhitespace.test(t.data)||this.handleElement(t)},s.prototype.writeComment=function(t){this.handleElement(t)},s.prototype.writeDirective=function(t){this.handleElement(t)},s.prototype.error=function(t){this.handleCallback(t)},s.prototype._options=null,s.prototype._callback=null,s.prototype._done=!1,s.prototype._tagStack=null,s.prototype.handleCallback=function(t){if("function"==typeof this._callback)this._callback(t,this.dom);else if(t)throw t},s.prototype.isEmptyTag=function(t){var e=t.name.toLowerCase();return"/"==e.charAt(0)&&(e=e.substring(1)),this._options.enforceEmptyTags&&!!s._emptyTags[e]},s.prototype.handleElement=function(t){if(this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete t.raw,("tag"==t.type||"script"==t.type||"style"==t.type)&&delete t.data),this._tagStack.last())if(t.type!=u.Text&&t.type!=u.Comment&&t.type!=u.Directive)if("/"==t.name.charAt(0)){var e=t.name.substring(1);if(!this.isEmptyTag(t)){for(var r=this._tagStack.length-1;r>-1&&this._tagStack[r--].name!=e;);if(r>-1||this._tagStack[0].name==e)for(;r<this._tagStack.length-1;)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t),this.isEmptyTag(t)||this._tagStack.push(t);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(t);else t.type!=u.Text&&t.type!=u.Comment&&t.type!=u.Directive?"/"!=t.name.charAt(0)&&(this.dom.push(t),this.isEmptyTag(t)||this._tagStack.push(t)):this.dom.push(t)};var l={testElement:function(t,e){if(!e)return!1;for(var r in t)if("tag_name"==r){if("tag"!=e.type&&"script"!=e.type&&"style"!=e.type)return!1;if(!t.tag_name(e.name))return!1}else if("tag_type"==r){if(!t.tag_type(e.type))return!1}else if("tag_contains"==r){if("text"!=e.type&&"comment"!=e.type&&"directive"!=e.type)return!1;if(!t.tag_contains(e.data))return!1}else if(!e.attribs||!t[r](e.attribs[r]))return!1;return!0},getElements:function(t,e,r,n){function i(t){return function(e){return e==t}}if(r=void 0===r||null===r||!!r,n=isNaN(parseInt(n))?-1:parseInt(n),!e)return[];var a,o=[];for(var s in t)"function"!=typeof t[s]&&(t[s]=i(t[s]));if(l.testElement(t,e)&&o.push(e),n>=0&&o.length>=n)return o;if(r&&e.children)a=e.children;else{if(!(e instanceof Array))return o;a=e}for(var c=0;c<a.length&&(o=o.concat(l.getElements(t,a[c],r,n)),!(n>=0&&o.length>=n));c++);return o},getElementById:function(t,e,r){var n=l.getElements({id:t},e,r,1);return n.length?n[0]:null},getElementsByTagName:function(t,e,r,n){return l.getElements({tag_name:t},e,r,n)},getElementsByTagType:function(t,e,r,n){return l.getElements({tag_type:t},e,r,n)}};e.Parser=a,e.DefaultHandler=s,e.RssHandler=o,e.ElementType=u,e.DomUtils=l}()}).call(e,"/index.js","/")},function(t,e){(function(e){t.exports={mapForLoop:function(t,e){for(var r=t.length,n=new Array(r),i=0;r>i;i++)n[i]=e(t[i],i,t);return n},eachObject:function(t,e){for(var r in t)t.hasOwnProperty(r)&&(t[r]=e(t[r]));return t},inArray:function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},isNode:function(){return"[object process]"===Object.prototype.toString.call(e.process)},isImplicitVar:function(t){return/^([A-z0-9\.]+)$/.test(t.trim())},isFunction:function(t){var e=t.split(/\(([^\(]*)\)/);return 1===e.length?!1:e},isVar:function(t){return!/['"].*?['"]/.test(t)&&isNaN(parseInt(t))},splitVarsAndFunctions:function(t){var e=0,r=0,n=[];return t.replace(/[^().]*([)]*)([(]*)(.)?/g,function(t,i,a,o,s,c){e+=a.length-i.length;var u=s+t.length;return!e&&o&&(n.push(c.substring(r,u-1)),r=u),t}),n.push(t.substring(r)),n},isVarFromScope:function(t,e){var r;return t.length>0?(r=this.isFunction(t[0]),r?e.hasOwnProperty(r[0]):e.hasOwnProperty(t[0])):!1},splitVarString:function(t){return t.split(".")},removeAroundQuotes:function(t){return t.trim().replace(/^['"](.*)['"]$/,"$1")},removeAllSpaces:function(t){return t.replace(/\s/g,"")},clone:function r(t){function e(t,e,r){var n,i,a={};for(n in e)i=e[n],n in t&&(t[n]===i||n in a&&a[n]===i)||(t[n]=r?r(i):i);return t}if(!t||"object"!=typeof t||"[object Function]"===Object.prototype.toString.call(t))return t;if(t.nodeType&&"cloneNode"in t)return t.cloneNode(!0);if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);var n,i,a;if(t instanceof Array)for(n=[],i=0,a=t.length;a>i;++i)i in t&&n.push(r(t[i]));else n=t.constructor?new t.constructor:{};return e(n,t,r)}}}).call(e,function(){return this}())},function(t,e,r){var n=r(3),i=r(5),a=r(6);t.exports={checkStatementForInners:function(t,e){var r,o=n.inArray(e,t);if(o===!0){if(!n.isImplicitVar(t)&&!n.isFunction(t)){if(r=i(t),void 0===r.condition)throw new Error("Wrong conditional expression: "+t);return a.createDataExpression(r.condition,r.valOne,r.valTwo)}return a.createDataVar(t,void 0)}return a.createDataText(t)}}},function(t,e){t.exports=function(t){function e(t){return t.splice(0,t.length).join("").trim()}function r(t){return t===h||t===p}function n(t){return t===d}function i(t){return t===f}function a(t){return n(t)&&v===!1&&y===!1}function o(t){return i(t)&&v===!0}function s(t,e){return t+1===e&&v===!0}function c(t,r){return void 0===t.valOne?t.valOne=e(r):t.valTwo=e(r),t}function u(t){return t===!1?!0:!1}for(var l=t.split(""),h="'",p='"',f=":",d="?",m=[],g={},v=!1,y=!1,_=l.length,w=0;_>w;w++)r(l[w])&&(y=u(y)),a(l[w])?(g.condition=e(m),v=!0):o(l[w])?g.valOne=e(m):m.push(l[w]),s(w,_)&&(g=c(g,m));return g}},function(t,e){t.exports={isTag:function(t){return"tag"===t},isText:function(t){return"text"===t},parserMatcher:function(t){return void 0!==this._modules[t.name]?this._modules[t.name].parse:!1},moduleMatcher:function(t){return void 0!==this._modules[t.name]?this._modules[t.name].module:!1},loadModuleFunction:function(t,e,r){var n=t(e,r);return n.call(this)},isTagInclude:function(t){return"ws-include"===t},isExpression:function(t){return t.split("?").length>1},createDataRequest:function(t){return{type:"request",name:t}},createDataVar:function(t,e){return{type:"var",name:t,value:e}},createDataText:function(t){return{type:"text",value:t}},createDataExpression:function(t,e,r){return{type:"expression",expression:t.trim(),valueOne:e,valueTwo:r}}}},function(t,e,r){(function(e){var r=function(){"use strict";function t(t,r){t.forEach(function(t){e(t,r)})}return"function"!=typeof e&&(e=function(t,e){return setTimeout(function(){t(e)},0)}),{make:function n(){function e(t,e,r){var n="keep"===t?o:a;n[n.length]="function"!=typeof e?r[t]:function(t){var n=e(t);n&&n.is_promise===!0?n.when(r.keep,r["break"]):r.keep(n)}}function r(e,r,n){if("pending"!==s)throw"overpromise";i=r,s=e,t(n,i),o.length=0,a.length=0}var i,a=[],o=[],s="pending";return{"break":function(t){r("broken",t,a)},keep:function(t){r("kept",t,o)},promise:{is_promise:!0,when:function(r,c){var u=n();switch(s){case"pending":e("keep",r,u),e("break",c,u);break;case"kept":e("keep",r,u),t(o,i);break;case"broken":e("break",c,u),t(a,i)}return u.promise}}}},every:function(t){var e=t.length,n=[],i=r.make();return e?t.forEach(function(t,r){t.when(function(t){n[r]=t,e-=1,0===e&&i.keep(n)},function(t){e=NaN,i["break"](t)})}):i["break"](t),i.promise},first:function(t){function e(){i-=1,0!==i||n||a["break"]()}var n=!1,i=t.length,a=r.make();return 0===i?a["break"](t):t.forEach(function(t){t.when(function(t){n||(n=!0,a.keep(t)),e()},e)}),a.promise},any:function(t){function e(){n-=1,0===n&&a.keep(i)}var n=t.length,i=[],a=r.make();return n?t.forEach(function(t,r){t.when(function(t){i[r]=t,e()},e)}):a.keep(i),a.promise},kept:function(t){var e=r.make();return e.keep(t),e.promise},broken:function(t){var e=r.make();return e["break"](t),e.promise}}}();t.exports=r}).call(e,r(8).setImmediate)},function(t,e,r){(function(t,n){function i(t,e){this._id=t,this._clearFn=e}var a=r(9).nextTick,o=Function.prototype.apply,s=Array.prototype.slice,c={},u=0;e.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},e.setImmediate="function"==typeof t?t:function(t){var r=u++,n=arguments.length<2?!1:s.call(arguments,1);return c[r]=!0,a(function(){c[r]&&(n?t.apply(null,n):t.call(null),e.clearImmediate(r))}),r},e.clearImmediate="function"==typeof n?n:function(t){delete c[t]}}).call(e,r(8).setImmediate,r(8).clearImmediate)},function(t,e){function r(){u=!1,o.length?c=o.concat(c):l=-1,c.length&&n()}function n(){if(!u){var t=setTimeout(r);u=!0;for(var e=c.length;e;){for(o=c,c=[];++l<e;)o[l].run();l=-1,e=c.length}o=null,u=!1,clearTimeout(t)}}function i(t,e){this.fun=t,this.array=e}function a(){}var o,s=t.exports={},c=[],u=!1,l=-1;s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new i(t,e)),1!==c.length||u||setTimeout(n,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=a,s.addListener=a,s.once=a,s.off=a,s.removeListener=a,s.removeAllListeners=a,s.emit=a,s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e,r){var n=r(11),i=r(6),a=r(7);t.exports={parse:function(t){function e(t){return t}function r(){var t=a.make();return this.includeStack[o]=n.call(this,s).when(e),t.keep(i.createDataRequest(o)),t.promise}var o=t.attribs.name.trim(),s=t.attribs.template.trim();return function(){return r.call(this)}}}},function(t,e,r){var n,i=r(3),a=r(7);t.exports=function(o){function s(t){var e=new XMLHttpRequest;return e.open("GET",t),e.send(),e}function c(t){var e,r=a.make();try{e=requirejs("fs")}catch(n){throw new Error("There is no requirejs for node included")}return e.readFile(t,function(t,e){t?r["break"](t):r.keep(this.parse(e))}.bind(this)),r.promise}function u(t){var e=a.make(),r=s(t);return r.onreadystatechange=function(){4===r.readyState&&200===r.status&&e.keep(this.parse(r.responseText))}.bind(this),e.promise}var l=i.isNode(),h=function(t,e){return t+"."+e},p=void 0!==this.resolver?this.resolver:h,f=p(o,"tmpl");return l===!1&&(n=function(){return{}}.call(e,r,e,t),!(void 0!==n&&(t.exports=n))),l?c.call(this,f):u.call(this,f)}},function(t,e,r){var n=r(7),i=r(6);t.exports={parse:function(t){function e(){var e=n.make();return this.templateStack[r]=t.children,e.keep(i.createDataRequest(r)),e.promise}var r;try{r=t.attribs.name.trim()}catch(a){throw new Error("Something wrong with name attribute in ws-template tag")}if(0===t.children.length)throw new Error("There is got to be a children in ws-template tag");return function(){return e.call(this)}}}},function(t,e,r){var n=r(7);t.exports={parse:function(t){function e(){var e=n.make();if(void 0===this.templateStack[r])throw new Error('There is no ws-template tag with "'+r+'" name');return this.traversingAST(this.templateStack[r]).when(function(r){t.children=r,e.keep(t)},function(t){throw new Error(t)}),e.promise}var r;try{r=t.attribs.name.trim()}catch(i){throw new Error("Something wrong with name attribute in ws-applytemplate tag")}return function(){return e.call(this)}},module:function(t,e){function r(){return this._process(t.children,e[n])}var n;return t.attribs.data&&(n=t.attribs.data.trim()),function(){return r.call(this)}}}},function(t,e,r){var n=r(7);r(3);t.exports={parse:function(t){function e(){var e=n.make();if(void 0===this.includeStack[r])throw new Error('Include tag for "'+r+'" is not found!');return this.includeStack[r].when(function(n){n?this.traversingAST(n).when(function(r){t.children=r,e.keep(t)},function(t){throw new Error(t)}):e["break"]('Include tag for "'+r+'" is not found!')}.bind(this),function(t){throw new Error(t)}),e.promise}var r=(t.attribs.data.trim(),t.attribs.template.trim());return function(){return e.call(this)}},module:function(t,e){function r(){return a[i]=e[n],this._process(t.children,a)}var n=t.attribs.data.trim(),i="root",a={};return function(){return r.call(this)}}}},function(t,e,r){var n=r(3),i=r(16),a=r(21),o=r(6);t.exports={_modules:{"ws-if":r(22),"ws-for":r(23),"ws-else":r(24),"ws-partial":r(14),"ws-applytemplate":r(13)},_ifStack:{},getHTMLString:function(t,e){return this._process(t,e)},_processModule:function(t,e){var r=o.moduleMatcher.call(this,t);return o.loadModuleFunction.call(this,r,t,e)},_whatMethodShouldYouUse:function(t){return o.isTag(t.type)?this._modules[t.name]?this._processModule:this._processTag:o.isText(t.type)?this._processText:void 0},_stopArrs:function(t){var e="";if("array"===a(t)){for(var r=0;r<t.length;r++)e+=t[r];return e}return t},_seek:function(t,e){var r=this._whatMethodShouldYouUse(t);return r?this._stopArrs(r.call(this,t,e)):void 0},_processDataTypes:function(t,e){var r=i(t,e);return void 0!==r&&null!==r?r:""},_processData:function(t,e){var r="";if(void 0!==t.length){for(var n=0;n<t.length;n++)r+=this._processDataTypes(t[n],e);return r}return this._processDataTypes(t,e)},_processAttributes:function(t,e){var r,i="";if(t)for(var a in t)t.hasOwnProperty(a)&&(r=this._processData(t[a].data,e),""!==n.removeAllSpaces(r)&&(i+=" "+(a+'="'+r+'"')));return i},_processText:function(t,e){return this._processData(t.data,e)},_processTag:function(t,e){return"<"+t.name+this._processAttributes(t.attribs,e)+">"+this._process(t.children,e)+"</"+t.name+">"},_process:function(t,e){for(var r,n="",i=0;i<t.length;i++)r=this._seek(t[i],e),r&&(n+=r);return n}}},function(t,e,r){var n=r(17),i=r(3),a=r(6),o=r(20);t.exports=function(t,e){function r(t,e){return void 0!==t?i.isVar(t)?o(a.createDataVar(t,void 0),e):i.removeAroundQuotes(t):void 0}function s(t){return n(t.expression,e)?r(t.valueOne,e):r(t.valueTwo,e)}return"expression"===t.type?s(t):"var"===t.type?o(t,e):t.value}},function(t,e,r){var n=r(18),i=r(3);t.exports=function(t,e){function r(t){for(var e=0;e<s.operators.length;e++)t=t.replace(s.operators[e].name,s.operators[e].value);return t}function a(t){for(var e=t.match(/([A-z0-9'"]+)/g),r=e.length,n=[],a=0;r>a;){var o=e[a++];n.indexOf(o)<0&&!i.inArray(c,o)&&i.isVar(o)&&n.push(o)}return n}function o(t,e){return Function.apply(null,e.concat("return "+t))}var s={operators:[{name:" lt ",value:"<"},{name:" gt ",value:">"},{name:" le ",value:"<="},{name:" ge ",value:">="}]},c=["false","true","undefined","null"],t=r(t),u=a(t),l=o(t,u);return l.apply(this,n(u,e))}},function(t,e,r){var n=r(19);t.exports=function(t,e){for(var r,i=[],a=0;a<t.length;a++)e.hasOwnProperty(t[a])&&(r=n(t[a],e,t),r.isVar===!0&&i.push(r.value));return i}},function(t,e,r){var n=r(3),i=r(20);t.exports=function(t,e,r){function a(t){return t?"var":"text"}function o(t,e,r){return t?{isVar:t,name:r,value:e}:{isVar:t,value:e}}var s=".",c=(t.split(s),n.inArray(r,t));return c===!0?o(c,i({type:a(c),name:t,value:void 0},e),t):o(c,t)}},function(t,e,r){var n=r(3);t.exports=function(t,e){function r(t){var e=t.split(",");return e.length>0&&(e=n.mapForLoop(e,function(t){return t=t.trim(),n.isVar(t)?s({name:t}):n.removeAroundQuotes(t).trim()})),e}function i(t,e,n,i,a){var o=t[0],s=r(t[1]);return n.hasOwnProperty(o)&&0===a?e=n[o].apply(n,s):e&&(e=e[o].apply(e,s)),e}function a(t,e,r,a){var o=n.isFunction(r[a]);return o?t=i(o,t,e,r[a],a):0===a?t=e[r[a]]:t&&(t=t[r[a]]),t}function o(t,e){for(var r,n=0;n<e.length;n++)r=a(r,t,e,n);return r}function s(t){var r=n.splitVarsAndFunctions(t.name);return o(e,r)}return s(t)}},function(t,e){t.exports=function(t){for(var e=function(t){if(null===t)return"null";if(t&&(1===t.nodeType||9===t.nodeType))return"element";var e=Object.prototype.toString.call(t),r=e.match(/\[object (.*?)\]/)[1].toLowerCase();if("number"===r){if(isNaN(t))return"nan";if(!isFinite(t))return"infinity"}return r},r=["Null","Undefined","Object","Array","String","Number","Boolean","Function","RegExp","Element","NaN","Infinite"],n=function(t){e["is"+t]=function(r){return e(r)===t.toLowerCase()}},i=0;i<r.length;i++)n(r[i]);return e(t)}},function(t,e,r){var n=r(17);t.exports={module:function(t,e){function r(){return n(i,e)&&void 0!==t.children?this._process(t.children,e):void 0}var i;if(void 0===t.attribs.data.data)throw new Error('There is no data for "if" module to use');return i=t.attribs.data.data.value.trim(),function(){return void 0!==t.children?r.call(this):void 0}}}},function(t,e,r){var n=r(19),i=r(21),a=r(3);t.exports={module:function(t,e){function r(t){var e=t.split(g.key);return e.length>1?{key:e[0],value:e[1]}:{key:void 0,value:e[0]}}function o(t,e,r,n){return e[n.value]=t[r],n.key&&(e[n.key]=r),e}function s(t){return e[t.value]=void 0,t.key&&(e[t.key]=void 0),e}function c(e,r){for(var n=[],i=0;i<e.length;i++)n.push(this._process(a.clone(t.children),o(e,r,i,f)));return n}function u(e,r){var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push(this._process(a.clone(t.children),o(e,r,i,f)));return n}function l(t){var r,n=t.value,a=m[i(n)];if(void 0===a)throw new Error("Wrong type in for statement arguments");
return r=a.call(this,n,e),e=s(f),r}var h,p,f,d,m={array:c,object:u},g={splittingKey:" in ",key:" as "};if(void 0===t.attribs.data.data)throw new Error('There is no data for "for" module to use');if(h=t.attribs.data.data.value.trim(),p=h.split(g.splittingKey),p.length<2)throw new Error("Wrong arguments in for statement");if(d=n(p[1],e,[p[1]]),!d.value)throw new Error(d.name+" variable is undefined");return f=r(p[0]),function(){return void 0!==t.children?l.call(this,d):void 0}}}},function(t,e,r){var n=r(17);t.exports={module:function(t,e){function r(){return n(i,e)||void 0===t.children?void 0:this._process(t.children,e)}var i;if(void 0===t.prev||"ws-if"!==t.prev.name)throw new Error('There is no "if" for "else" module to use');return i=t.prev.attribs.data.trim(),function(){return void 0!==t.children?r.call(this):void 0}}}}])});